package (
    compile)
with
    import './stage/lexical' lexical,
    import './stage/normalize' normalize,
    import './stage/transform' transform,
    import './stage/khepri_peep' khepri_peep,
    import './stage/ecma_peep' ecma_peep
in {

var compiler :=
       normalize
    \> lexical
    \> khepri_peep
    \> transform
    \> ecma_peep;

compile =
    (\root options -> ({
        'ast': root,
        'options': options || {}}))
   \>> compiler
   \> \{ast} -> ast;

}